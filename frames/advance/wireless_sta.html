<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- include page -->
<link type="text/css" rel="stylesheet" href="common.css" media="screen" />
<script language="javascript" type="text/javascript" src="jquery-1.3.2.js"></script>
<script language="JavaScript" type="text/javascript" src="language.js"></script>
<script language="javascript" type="text/javascript" src="global.js"></script>
<script language="javascript" type="text/javascript">
var myjson;
var selectmode;
$(function(){
	$.getJSON("dataCenter.js", {
		//common parameters
		lan_backupip:"",lan_backupnetmask:"",router_disable:"",lan_apmodeip:"",
		lan_apmodenetmask:"",lan_ipaddr:'',sta_enable:"",assoc_ssid:"",stainterface:'',
		sta_assocencmode:"",sta_assocpassword:"",sta_assocauthmode:"",
		//2G				                    //5G
//		wl0_sta_assocencmode:"",                wl1_sta_assocencmode:"", 
//		wl0_sta_assocpassword:"",               wl1_sta_assocpassword:"",               
//		wl0_sta_assocauthmode:"",               wl1_sta_assocauthmode:"",             	
		wl0_auth:'',             	            wl1_auth:'',                		 	
		wl0_key:'',               	            wl1_key:''                 		 			 	
	},function(json){
		myjson = json;
		$(":radio[name=STA_interface][value="+myjson.stainterface+"]").attr("checked",'true');//默认选中按钮---2G/5G
		//alert(myjson.stainterface);
		if(myjson.sta_enable==1)//读取默认值后，在此判断
			$("#sta_enble").attr("checked",true);//默认值为1时Enable STA
		else
			$("#sta_enble").attr("checked",false);//默认值为0时Disable STA

		if($('#sta_enble').attr('checked')){//Enabled
			StaOptionsEnable();//启用所有
		}else{//Disabled
			StaOptionsDisable();//禁用所有
		}
		stainterface =$('input:radio[name="STA_interface"]:checked').val();//得到2G/5G选中按钮的属性值0--2G 1--5G
		selectmode = stainterface;			
		SecurityOptions(selectmode);//根据属性值初始化对应参数（json格式）				
		//1. STA选项更改时触发启、禁用操作
		$(":checkbox").change(function(){
			if($('#sta_enble').attr('checked')){
				StaOptionsEnable();
				SecurityOptions(selectmode);
			}else{
				StaOptionsDisable();
			}			
		});
		//2. 2G、5G模式更改时触发启、禁用操作
		$(':radio[name="STA_interface"]').change(function(){
			stainterface =$('input:radio[name="STA_interface"]:checked').val();
			//alert(stainterface);
			selectmode = stainterface;
			SecurityOptions(selectmode);
		});
		//3. Security Options选项更改时触发的启、禁用及菜单隐藏操作
		$("#SELECT_Securityoptions").change(function(){
			SecurityOptions(selectmode);
		});
		
    });

});
//当STA按钮选中时，启用所有选项
function StaOptionsEnable()
{
//	alert("In StaOptionsEnable() !");
	$('#INPUTSsid,#lang_apply1').attr('disabled',false);//启用Connection按钮
	$('#2G_STA,#5G_STA').attr('disabled',false);//启用 2G/5G 按钮
	$("#SELECT_Securityoptions").attr('disabled',false);//启用安全选项
	$("#conn_ssid").html(myjson.assoc_ssid);//写入连接状态：读取assoc_ssid默认值
//	alert(myjson.assoc_ssid);
}
//当STA按钮未选中时，禁用所有选项
function StaOptionsDisable(json)
{
	$('#INPUTSsid,#lang_apply1').attr('disabled',true);//禁用Connection按钮
	$('#2G_STA,#5G_STA').attr('disabled',true);//禁用 2G/5G 按钮
	$("#SELECT_Securityoptions").attr('disabled',true);//禁用安全选项
	$("#module_wep, #module_tkip, #module_aes, #module_tkipaes").hide();//其他已打开选项也隐藏
	//supplyValue('conn_ssid',json.router_disable);
}

/********************security  start************************/
function SecurityOptions(selectmode)
{	
	var wl_prev = 'wl'+selectmode;//wl0_ / wl1_
	var _key = wl_prev+'_key';//wep密码
	var _auth = wl_prev+'_auth';//wep认证类型
	var select_opt = $("#SELECT_Securityoptions").val();

	if(select_opt=="none")
	{
		$("#module_wep, #module_tkip, #module_aes, #module_tkipaes").hide();
	}
	else if(select_opt=="wep")
	{
		$("#module_tkip, #module_aes, #module_tkipaes").hide();
		$("#module_wep").show();
		
		$("#SELECT_Authtype").val(myjson[_auth]);
		$(":radio[name=INPUT_radiokey][value="+myjson[_key]+"]").attr("checked",'true');//根据myjson[_key]初始值选中某个key选框
		WepKeyChange();
		WepKeySet();//设置key
	}
	else if(select_opt=="tkip")
	{
		$("#module_wep, #module_aes, #module_tkipaes").hide();
		$("#module_tkip").show();
		
		$("#INPUT_tkipkey").val(myjson[sta_assocpassword]);
	}
	else if(select_opt=="aes")
	{
		$("#module_wep, #module_tkip, #module_tkipaes").hide();
		$("#module_aes").show();
		
		$("#INPUT_aeskey").val(myjson[sta_assocpassword]);
	}
	else if(select_opt=="tkipaes")
	{
		$("#module_wep, #module_tkip, #module_aes").hide();
		$("#module_tkipaes").show();
		
		$("#INPUT_tkipaeskey").val(myjson[sta_assocpassword]);
	}
}
//设置4个key
function WepKeySet()
{
	$("#INPUT_key"+myjson[_key]).val(myjson[_key]);//设置初始值
	for (var i=1; i<=4; i++)
	{
		if ($("#INPUT_key"+i).val().length>26)//密码最大字符长度不超过26
		{
			$('#INPUT_key'+i).val($('#INPUT_key'+i).val().substring(0,26));		
		}
		$("#INPUT_key"+i).attr({maxlength:26,size:34});
	}
	WepKeyChange();
}
//禁、启用4个key
function WepKeyChange()
{
	for (var i=1; i<=4; i++)
	{
		$("#INPUT_key"+i).attr("disabled", ($("input[name=INPUT_radiokey]:checked").val()==i) ? false : true);
	}
}
/**************security end********************/

function uiKeyInputMaxlength()
{
		return 26;
}

function uiSubmit(){
	var tmp = myjson.lan_ipaddr.split('.');
	var interfaceIp=tmp[0]+"."+tmp[1]+"."+tmp[2]+"."+2;
	
	var postVar = { action : "Apply", mode:"tw_apstaSwitch",getPage:"restarting.html",_flg:0};
	
	if($('#sta_enble').attr('checked'))
	{
		postVar["lan_ipaddr"]=interfaceIp;
		postVar["lan_apmodeip"]=interfaceIp;
		postVar["router_disable"]=1;
		postVar["sta_enable"]=1;
		postVar['wl0_wds_enable']=0;
		postVar['wl1_wds_enable']=0;
		/************security  start**************/
		var _tmp,_prev;		
		_prev = 'wl'+selectmode;//selectmode值：0-wl0->2G 1-wl1->5G
		
		if($("#SELECT_Securityoptions").val()=="none")
		{//1.只提交加密方式：none
			_tmp = 'sta_assocencmode';
			postVar[_tmp]= "none";
		}
		else if($("#SELECT_Securityoptions").val()=="wep")
		{
			_tmp = 'sta_assocencmode';
			postVar[_tmp]= "wep";//1.提交加密方式
	
			_tmp = _prev+'_auth';
			postVar[_tmp]= $("#SELECT_Authtype").val();//2.提交wep认证类型
			
			_tmp = _prev+'_key';
			postVar[_tmp]= $("input[name=INPUT_radiokey]:checked").val();//3.提交key
			
			_tmp = 'sta_assocpassword';
			var key = $("input[name=INPUT_radiokey]:checked").val();//key编号
			postVar[_tmp]= $("#INPUT_key"+key).val();//4.提交key密码
		}
		else if($("#SELECT_Securityoptions").val()=="tkip")
		{
			_tmp = 'sta_assocencmode';
			postVar[_tmp]= "tkip";//1.提交加密方式
	
			_tmp = 'sta_assocauthmode';
			postVar[_tmp]= "wpapsk";//2.提交tkip加密算法
			
			_tmp = 'sta_assocpassword';
			postVar[_tmp]= $("#INPUT_tkipkey").val();//3.提交加密密码
		}
		else if($("#SELECT_Securityoptions").val()=="aes")
		{
			_tmp = 'sta_assocencmode';
			postVar[_tmp]= "aes";//1.提交加密方式
	
			_tmp = 'sta_assocauthmode';
			postVar[_tmp]= "wpa2psk";//2.提交tkip加密算法
			
			_tmp = 'sta_assocpassword';
			postVar[_tmp]= $("#INPUT_aeskey").val();//3.提交加密密码
		}
		else if($("#SELECT_Securityoptions").val()=="tkipaes")
		{
			_tmp = 'sta_assocencmode';
			postVar[_tmp]= "tkip*aes";//1.提交加密方式
	
			_tmp = 'sta_assocauthmode';
			postVar[_tmp]= "wpapsk/wpa2psk";//2.提交tkip加密算法
			
			_tmp = 'sta_assocpassword';
			postVar[_tmp]= $("#INPUT_tkipaeskey").val();//3.提交加密密码
		}
		/**************security end*****************/
	}else{
		postVar["router_disable"]=0;
		postVar["sta_enable"]=0;
		postVar["lan_ipaddr"]=myjson.lan_backupip;
	}
	
	uiPost(postVar);
	return ;    
}

function uiConnect(){

	var postVar = { action : "Apply", mode:"tw_staAssoc",getPage:"wireless_sta.html"};
	
	//interface
	var stainterface =$('input:radio[name="STA_interface"]:checked').val();

	postVar["_flg"]=0;
	
	if(myjson.sta_enable==1)
	{
		;//ok
	}else{
		alert('should set to STA mode first');
	}
	var assocSSID = $("#INPUTSsid").val();
	postVar["sta_assocssid"]=assocSSID;
	postVar["stainterface"]=stainterface;
	
	/************security  start**************/
	var _tmp,_prev;		
	_prev = 'wl'+selectmode;//selectmode值：0-wl0->2G 1-wl1->5G
	
	if($("#SELECT_Securityoptions").val()=="none")
	{//1.只提交加密方式：none
		_tmp = 'sta_assocencmode';
		postVar[_tmp]= "none";
	}
	else if($("#SELECT_Securityoptions").val()=="wep")
	{
		_tmp = 'sta_assocencmode';
		postVar[_tmp]= "wep";//1.提交加密方式

		_tmp = _prev+'_auth';
		postVar[_tmp]= $("#SELECT_Authtype").val();//2.提交wep认证类型
		
		_tmp = _prev+'_key';
		postVar[_tmp]= $("input[name=INPUT_radiokey]:checked").val();//3.提交key
		
		//_tmp = _prev+'_sta_assocpassword';
		_tmp = 'sta_assocpassword';
		var key = $("input[name=INPUT_radiokey]:checked").val();//key编号
		postVar[_tmp]= $("#INPUT_key"+key).val();//4.提交key密码
	}
	else if($("#SELECT_Securityoptions").val()=="tkip")
	{
		_tmp = 'sta_assocencmode';
		postVar[_tmp]= "tkip";//1.提交加密方式

		_tmp = 'sta_assocauthmode';
		postVar[_tmp]= "wpapsk";//2.提交wpapsk加密算法
		
		_tmp = 'sta_assocpassword';
		postVar[_tmp]= $("#INPUT_tkipkey").val();//3.提交加密密码
	}
	else if($("#SELECT_Securityoptions").val()=="aes")
	{
		_tmp = 'sta_assocencmode';
		postVar[_tmp]= "aes";//1.提交加密方式

		_tmp = 'sta_assocauthmode';
		postVar[_tmp]= "wpa2psk";//2.提交wpa2psk加密算法
		
		_tmp = 'sta_assocpassword';
		postVar[_tmp]= $("#INPUT_aeskey").val();//3.提交加密密码
	}
	else if($("#SELECT_Securityoptions").val()=="tkipaes")
	{
		_tmp = 'sta_assocencmode';
		postVar[_tmp]= "tkip*aes";//1.提交加密方式

		_tmp = 'sta_assocauthmode';
		postVar[_tmp]= "wpapsk/wpa2psk";//2.提交wpapsk/wpa2psk加密算法
		
		_tmp = 'sta_assocpassword';
		postVar[_tmp]= $("#INPUT_tkipaeskey").val();//3.提交加密密码
	}
	/**************security end*****************/		

	uiPost(postVar);
	return ;
	
}
</script>

<div class="config3">
	<div id="lang_title" class="mainbiao"></div>
    <table class="table01" cellpadding="0" cellspacing="0"><tbody>
        <tr><td class="lable" colspan="3"><input type="checkbox" id="sta_enble"><b><span id="lang_Enable"></span></b></td></tr>
        <tr>
			<td width="30%" id="lang_Network_Adapter"></td>
			<td>
				<input type="radio" id="2G_STA" checked="" value="0" name="STA_interface">2G
				<input type="radio" id="5G_STA" checked="" value="1" name="STA_interface">5G
			</td>
			<td></td>	
		</tr>
		<tr>
			<td width="30%"><span id="lang_conn"></span></td>
            <td width="39%">
            	<input type="text" id="INPUTSsid">
            </td>
			<td width="30%">
				<input type="button" id="lang_apply1" onClick="uiConnect();">
			</td>
        </tr>
       <tr>
       		<td id="lang_conn_status" ></td>
            <td><b><span id="conn_ssid"></span></b></td>
			<td></td>
       </tr>
		<tr>
			<td><span id="lang_SecurityOptions"></span></td>
			<td><select id="SELECT_Securityoptions">
					<option value="none">None</option>
					<option value="wep">Wep</option>
					<option value="tkip">WPA-PSK[TKIP]</option>
					<option value="aes">WPA2-PSK[AES]</option>
					<option value="tkipaes">WPA-PSK[TKIP]+WPA2-PSK[AES]</option>
				</select>
			</td>
			<td></td>	
		</tr>	 
    </tbody></table>
<!-- 隐藏菜单 -->	
<div id="module_wep" style="display:none">
<table  class="table01"><tbody>
    <tr><td class="lable" colspan="2"><p id="lang_SecurityEncryptionWep"></p></td></tr>
    <tr>
        <td width="30%"><span id="lang_AuthenticationType"></span></td>
        <td><select name="select" id="SELECT_Authtype" >
                  <option value="2" id="lang_automatic"></option>
                  <option value="1" id="lang_shared"></option>
            </select>	
        </td>
    </tr>
<!--    <tr>
        <td><span id="lang_EncryptionStrength"></span></td>
        <td ><select id="SELECT_Encryptstrength" onChange="setKeys();">
                <option value="64bits" id="lang_length64"></option>
                <option value="128bits" id="lang_length128"></option>					
    		</select>
        </td>
    </tr>-->
    <tr><td class="lable" colspan="2"><p id="lang_SecurityEncryptionWepKey"></p></td></tr>
    <tr>
    	<td width="30%">
            <span id="lang_key1"></span>
            <input type="radio"  name="INPUT_radiokey" id="INPUT_radiokey1" value="1" onclick="WepKeyChange();">
        </td>
    	<td><input type="text" id="INPUT_key1" onFocus="this.maxLength=uiKeyInputMaxlength();"></td>
    </tr>
    <tr>
    	<td >
        	<span id="lang_key2"></span>
            <input type="radio"  name="INPUT_radiokey"  id="INPUT_radiokey2" value="2" onclick="WepKeyChange();">
        </td>
    	<td ><input type="text" id="INPUT_key2" onFocus="this.maxLength=uiKeyInputMaxlength();"></td>
    </tr>
    <tr>
    	<td >
        	<span id="lang_key3"></span>
            <input type="radio"  name="INPUT_radiokey"  id="INPUT_radiokey3" value="3" onclick="WepKeyChange();">
        </td>
    	<td><input type="text" id="INPUT_key3" onFocus="this.maxLength=uiKeyInputMaxlength();"></td>
    </tr>
    <tr>
    	<td>
        	<span id="lang_key4"></span>
            <input type="radio"  name="INPUT_radiokey"  id="INPUT_radiokey4" value="4" onclick="WepKeyChange();">
        </td>
    	<td><input type="text" id="INPUT_key4" onFocus="this.maxLength=uiKeyInputMaxlength();"></td>
    </tr>
</tbody>
</table>
</div><!---end of <div id="module_wep">--->

<div id="module_tkip" style="display:none">
<table class="table01">
<tbody>
    <tr><td colspan="2" class="lable"><p id="lang_SecurityOptionsWpaPsk"></p></td></tr>
    <tr>
    	<td width="30%"><span id="lang_PassPhraseWpaPsk"></span></td>
    	<td>
        	<input type="text" id="INPUT_tkipkey" size="20" maxlength="64" style="width:auto ">
            <span id="lang_charactersWpaPsk"></span>
        </td>
    </tr>
</tbody>
</table>
</div><!---end of <div id="module_tkip">--->

    
<div id="module_aes" style="display:none">
<table class="table01">
<tbody>
    <tr><td colspan="2" class="lable"><p id="lang_SecurityOptionsWpa2Psk"></p></td></tr>
    <tr>
        <td width="30%"><span id="lang_PassPhraseWpa2Psk"></span></td>
        <td>
        	<input type="text"  id="INPUT_aeskey" size="20" maxlength="64" style="width:auto ">
            <span id="lang_charactersWpa2Psk"></span>
        </td>
    </tr>
</tbody>
</table>
</div><!---end of <div id="module_aes">--->

<div id="module_tkipaes" style="display:none">
<table class="table01">
<tbody>
    <tr><td class="lable" colspan="2"><p id="lang_SecurityOptionsWpaPskWpa2Psk"></p></td></tr>
    <tr>
        <td width="30%"><span id="lang_PassPhraseWpaPskWpa2Psk"></span></td>
        <td >
        	<input type="text"  id="INPUT_tkipaeskey" size="20" maxlength="64" style="width:auto ">
            <span id="lang_charactersWpaPskWpa2Psk"></span>
        </td>
    </tr>
</tbody>
</table>
</div><!---end of <div id="module_tkipaes">--->
<!--  wangli added end 2013.10.17 -->

     <div class="div_button">
        <input type="button" id="lang_cancle" onClick="uiPageRefresh();">&nbsp;&nbsp;
        <input type="button" id="lang_apply" onClick="uiSubmit();">
  </div>
</div>
